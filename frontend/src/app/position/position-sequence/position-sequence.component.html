<div class="positions-container">
  <!-- Selected Positions -->
  <div class="selected-positions-container" #selectedPositionsContainer>
    <div class="selected-positions">
      <div class="positions-header">
        <h3>Ausgewählte Positionen</h3>
        <div class="toolbar-group">
          <app-toolbar
            [showDelete]="true"
            [deleteDisabled]="!hasSelectedPositions()"
            [showAdd]="true"
            (delete)="deleteSelectedPositions()"
            (add)="openPositionSelector()">
          </app-toolbar>
        </div>
      </div>

      <div class="positions-grid" cdkDropList (cdkDropListDropped)="onDrop($event)">
        <div *ngFor="let position of selectedPositions; let i = index" 
             class="position-card"
             cdkDrag
             [cdkDragData]="position">
          <div class="position-header">
            <button mat-icon-button class="check-circle" (click)="toggleSelection(position)">
              <mat-icon class="check-circle-icon" [ngClass]="{ 'selected': position.isSelected }">
                {{ position.isSelected ? 'check_circle' : 'radio_button_unchecked' }}
              </mat-icon>
            </button>
            <span class="position-number">{{ i + 1 }}</span>
            <span class="position-name">{{ position.name }}</span>
            <button class="button button-label button-highlight-sub" (click)="onRemovePosition(position)">
              <mat-icon>remove</mat-icon>
              <span>Entfernen</span>
            </button>
            <div class="drag-handle" cdkDragHandle>
              <mat-icon>drag_handle</mat-icon>
            </div>
          </div>
          <div class="position-details">
            <div class="metric-column" *ngIf="position.timePreset !== undefined">
              <mat-icon>timer</mat-icon>
              <span class="label">Zeit</span>
              <span class="unit">s</span>
              <span class="value">{{ position.timePreset }}</span>
            </div>
            <div class="metric-column" *ngIf="position.currentPreset !== undefined">
              <mat-icon>bolt</mat-icon>
              <span class="label">Strom</span>
              <span class="unit">A</span>
              <span class="value">{{ position.currentPreset }}</span>
            </div>
            <div class="metric-column" *ngIf="position.voltagePreset !== undefined">
              <mat-icon class="mat-icon-filled">bolt</mat-icon>
              <span class="label">Spannung</span>
              <span class="unit">V</span>
              <span class="value">{{ position.voltagePreset }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Position Selector using new component -->
  <app-sidebar-sheet 
    title="Verfügbare Positionen"
    [(show)]="showPositionSelector"
    (showChange)="showPositionSelector = $event">
    
    <div class="available-positions">
      <div class="positions-grid">
        <div *ngFor="let position of positionService.orderedPositions()" class="position-card">
          <div class="position-header">
            <span class="position-name">{{ position.name }}</span>
            <button class="button button-label button-highlight-main" (click)="onAddPosition(position, $event)">
              <mat-icon>add</mat-icon>
              <span>Hinzufügen</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </app-sidebar-sheet>
</div>
