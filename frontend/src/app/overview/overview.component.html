<h1 class="font-main" i18n="@@overviewHeader">Übersicht</h1>

<div class="button-container" *ngIf="enableEdit() && !(isMobile() && newPosition)">
  <button class="button" 
    *ngIf="!isMobile() && enableEdit()" 
    (click)="increaseColumns()"
    tabindex="10"
    aria-label="Neue Linie hinzufügen"
    matTooltip="Neue Linie für Positionen hinzufügen"
    matTooltipPosition="below">
    <mat-icon>add</mat-icon>
    Linie hinzufügen
  </button>
  
  <button class="button" 
    *ngIf="(columns().length > 1) && !isMobile() && enableEdit()" 
    (click)="decreaseColumns()"
    tabindex="11"
    aria-label="Letzte Linie löschen"
    matTooltip="Letzte Linie entfernen"
    matTooltipPosition="below">
    <mat-icon>remove</mat-icon>
    Linie löschen
  </button>
  
  <button class="button" 
    *ngIf="enableEdit()" 
    (click)="addPosition()"
    tabindex="12"
    aria-label="Neue Position hinzufügen"
    matTooltip="Neue Position erstellen"
    matTooltipPosition="below">
    <mat-icon>add_circle</mat-icon>
    hinzufügen
  </button>
  
  <button class="button" 
    *ngIf="enableEdit()" 
    (click)="orderPositions()"
    tabindex="13"
    [attr.aria-label]="overviewStateService.enableOrder() ? 'Positionsansicht aktivieren' : 'Reihenfolge bearbeiten'"
    [matTooltip]="overviewStateService.enableOrder() ? 'Zurück zur Positionsansicht' : 'Reihenfolge der Positionen bearbeiten'"
    matTooltipPosition="below">
    <mat-icon>{{ overviewStateService.enableOrder() ? 'radio_button_unchecked' : 'reorder' }}</mat-icon>
    {{ overviewStateService.enableOrder() ? 'Positionen' : 'Reihenfolge' }}
  </button>
  
  <button class="button danger" 
    [disabled]="!hasSelectedPositions()"
    *ngIf="enableEdit() && !overviewStateService.enableOrder()" 
    (click)="deletePositions()"
    tabindex="14"
    aria-label="Ausgewählte Positionen löschen"
    [matTooltip]="hasSelectedPositions() ? 'Ausgewählte Positionen löschen' : 'Keine Positionen ausgewählt'"
    matTooltipPosition="below">
    <mat-icon>delete</mat-icon>
    löschen
  </button>
</div>

<div *ngIf="!(isMobile() && newPosition)" cdkDropListGroup>
  <div class="overview-container" [style.--total-columns]="columnManagementService.getColumnCount()">
    @for (column of columns(); track $index; let index = $index) {
      <div cdkDropList [cdkDropListData]="column" class="overview-list" (cdkDropListDropped)="drop($event, index)">
        <div *ngIf="!enableMultiSelect()" class="app-position-header">
          <div class="column-name">Linie {{index + 1}}</div>
          <div class="column-name"></div>
          <div *ngIf="!enableOrder()" class="column-metrics">
            <div>min</div>
            <div>°C</div>
            <div>A</div>
            <div>V</div>
          </div>
        </div>
        @for (position of column; track position.id) {
          <div class="list-item" cdkDrag [cdkDragDisabled]="!enableOrder()" [class.draggable]="enableOrder()">
            <app-position [position]="position"></app-position>
          </div>
        }
      </div>
    }
  </div>
</div>

<app-add-position 
  *ngIf="newPosition" 
  [ngClass]="{'position-edit-overlay': !isMobile(),'position-edit-mobile': isMobile()}" 
  class="position-edit-overlay" [position]="newPosition" 
  (savePosition)="savePosition($event)" 
  (cancelEdit)="closeAddPosition()">
</app-add-position>
